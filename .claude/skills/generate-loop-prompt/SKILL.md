---
name: "Generate Loop Prompt"
description: "Ralph Loop 실행용 프롬프트 파일을 loop-save/ 디렉토리에 생성한다. 코드 조사 결과나 구현 요구사항을 Phase 기반 실행 프롬프트로 변환할 때 사용한다."
---

# Generate Loop Prompt

사용자의 요구사항이나 코드 조사 결과를 Ralph Loop 실행용 프롬프트 파일로 변환하여 `loop-save/` 디렉토리에 저장한다.

## 실행 절차

### 1단계: 요구사항 파악

사용자가 제공한 정보를 분석한다:
- 구현해야 할 기능 또는 수정 사항
- 관련 파일 경로와 코드 구조
- 제약 조건 -- 수정 금지 영역, 아키텍처 규칙 등

정보가 부족하면 사용자에게 질문한다. 코드 조사가 필요하면 먼저 조사를 수행한다.

### 2단계: 관련 코드 조사

수정 대상 파일을 읽고 다음을 파악한다:
- 현재 코드 구조와 패턴
- 수정이 필요한 구체적 위치 -- 파일명, 함수명, 라인
- 의존 관계 -- 이 파일을 수정하면 영향받는 다른 파일
- 재사용할 수 있는 기존 유틸리티나 패턴

### 3단계: 프롬프트 파일 작성

`loop-save/{주제}-prompt.txt` 파일을 아래 양식으로 작성한다.

#### 양식

아래 양식을 따르되, 쉘 안전 텍스트 규칙을 반드시 적용한다.
양식 내의 중괄호는 "여기에 내용을 채우라"는 플레이스홀더 의미이며, 실제 출력에서는 중괄호 없이 내용만 쓴다.

-----

1~3줄 개요: 무엇을 하는지, 왜 하는지
수정하지 않을 범위나 제약 조건
CLAUDE.md 준수 규칙 명시

수정할 항목 목록 -- 번호 매기기

아래 N개 Phase를 순서대로 진행한다.
각 Phase 완료 후 반드시 아래 검증을 실행한다. 검증 실패 시 수정 후 다시 검증한다. 검증 통과 후 다음 Phase로 진행한다.
  백엔드 검증: cd flow-backend && npm run typecheck && npm run test && npm run lint
  프론트엔드 검증: cd flow-front && npx tsc -b && npm run lint && npm run build
각 Phase 완료 후 Playwright MCP를 통해 localhost:5173에 접속하여 실제 화면을 확인하고 문제가 있으면 즉시 수정한다.

----- Phase 1 제목 -----

핵심 파일:
  - 수정 대상 파일 경로
참조할 코드 -- 읽기만, 수정하지 않음:
  - 참조 파일 경로와 간단한 설명

1-1. 구체적 작업 지시
     상세 설명: 어떤 파일의 어떤 부분을 어떻게 수정하는지
     필요한 경우 코드 스니펫 -- 들여쓰기로 표현, 백틱 사용 금지

1-N. 검증 실행

----- Phase 2 제목 -----
동일 구조 반복

----- Phase N 통합 검증 -----

마지막 Phase는 항상 Playwright MCP를 통한 통합 검증
구체적 시나리오 목록
최종 검증 커맨드

모든 Phase가 완료되고 전체 시나리오 검증이 통과하면 COMPLETION_PROMISE 를 출력한다.

-----

#### 작성 규칙

1. **구체적으로 작성**: "적절히 수정한다" 대신 "serializeRun 메서드에 issueKey: run.issueKey 추가" 처럼 정확한 위치와 내용을 명시
2. **파일 경로 명시**: 모든 수정 대상 파일의 정확한 경로를 Phase 시작 부분에 나열
3. **참조 파일 분리**: 읽기만 하고 수정하지 않는 파일은 별도로 나열하여 실수 방지
4. **Phase 분리 기준**: 레이어별로 분리 -- 백엔드, 프론트엔드 타입, 프론트엔드 UI, 통합 검증
5. **검증 포함**: 각 Phase 끝에 반드시 검증 단계 포함
6. **완료 프로미스**: 파일 끝에 반드시 완료 시 출력할 문자열 명시
7. **제약 조건 선언**: 수정 금지 영역을 파일 상단에 명확히 선언
8. **쉘 안전 텍스트 -- 최우선 규칙**: 프롬프트 파일 전체 내용이 zsh eval을 통해 전달되므로, 프롬프트 파일의 모든 텍스트에서 쉘 메타문자를 절대 사용하지 않는다. 이 규칙은 설명문, 코드 스니펫, 주석 등 모든 텍스트에 적용된다.

   **금지 문자와 대체 표현:**

   | 금지 문자 | 대체 표현 | 예시 |
   |---|---|---|
   | 백틱 -- 세 개든 한 개든 | 들여쓰기 2칸으로 코드 블록 표현 | 코드는 들여쓰기로 표시 |
   | 소괄호 -- 열고 닫기 | 쉼표나 -- 구분자 사용 | "resume 없이" 대신 "resume 제외" |
   | 중괄호 -- 열고 닫기 | 대괄호나 텍스트로 풀어쓰기 | "Record 타입의 key: string, value: number" |
   | 달러 기호 | 텍스트로 풀어쓰기 | "환경변수 MY_VAR 참조" |
   | 작은따옴표 | 없이 쓰거나 큰따옴표도 금지 | 강조는 대문자나 -- 구분자 |
   | 큰따옴표 | 없이 쓰거나 대문자 강조 | |
   | 느낌표 | 마침표로 대체 | "주의." |
   | 꺾쇠 -- 부등호 | 화살표는 --> 사용, 제네릭은 텍스트로 풀어쓰기 | "Promise of void" |
   | 파이프 | "또는"으로 풀어쓰기 | "string 또는 number" |
   | 앰퍼샌드 | "그리고"로 풀어쓰기 | "typecheck 그리고 lint" |
   | 물결표 | 절대경로 사용 | |
   | 별표 | 텍스트 강조는 대문자 사용 | |
   | 물음표 | 마침표로 대체하거나 생략 | |
   | 대괄호 | 설명문에서만 허용, 타입 표현에서는 "배열" 등으로 풀어쓰기 | "string 배열" |
   | 백슬래시 | 사용 금지 | |
   | 해시 -- 샵 기호 | 번호 매기기에만 사용, 줄 시작에서만 | |
   | 세미콜론 | 쉘 명령어 체이닝에서만 허용 | |

   **코드 스니펫 작성법:**
   - 코드 블록을 백틱으로 감싸지 않는다
   - 대신 들여쓰기 2칸으로 코드를 표현한다
   - 타입 시그니처에서 제네릭은 풀어서 설명한다
     - AS-IS: `abstract runPipeline(id: WorkflowRunId): Promise<void>`
     - TO-BE: abstract runPipeline -- 파라미터 id의 타입은 WorkflowRunId, 반환 타입은 Promise of void
   - 함수 호출 표현에서 소괄호 대신 메서드명만 쓰거나 "호출"을 붙인다
     - AS-IS: `serializeRun()`
     - TO-BE: serializeRun 메서드 또는 serializeRun 호출

   **허용되는 유일한 예외:**
   - 검증 커맨드 라인 -- cd flow-backend && npm run typecheck && npm run test && npm run lint
   - 이 라인들은 그대로 쉘에서 실행되어야 하므로 &&를 허용한다
   - 단, 검증 커맨드 외의 본문에서는 && 대신 "그리고"를 사용한다

   **자가 검증:** 프롬프트 파일 작성 완료 후, 파일 내용에서 아래 정규식 패턴을 검색하여 금지 문자가 없는지 확인한다. 검증 커맨드 라인을 제외한 본문에서 매치되면 해당 부분을 수정한다.
   검색 패턴: 백틱, 소괄호, 중괄호, 달러기호, 작은따옴표, 큰따옴표, 느낌표, 꺾쇠, 파이프, 물결표, 백슬래시

### 4단계: reserve.sh 자동 설정

프롬프트 파일 생성 후 `reserve.sh`와 `reserve.bat`의 `PROMPT_FILE` 변수를 자동으로 갱신한다:

1. `reserve.sh` 파일을 읽는다.
2. `PROMPT_FILE=` 로 시작하는 줄을 찾아 새로 생성한 프롬프트 파일 경로로 교체한다.
   예: `PROMPT_FILE="loop-save/seed-monaco-prompt.txt"`
3. `reserve.bat` 파일이 존재하면 동일하게 `set PROMPT_FILE=` 줄을 교체한다.

### 5단계: 실행 안내

프롬프트 파일 생성과 reserve.sh 설정 완료 후 사용자에게 실행 방법을 안내한다:

  즉시 실행:
  1. /ralph-loop:ralph-loop
  2. 프롬프트: loop-save/파일명 내용 붙여넣기
  3. 옵션:
     --completion-promise COMPLETION_PROMISE 값
     --max-iterations 적절한 반복 횟수

  예약 실행:
    ./reserve.sh [시간] [분]
    reserve.sh의 PROMPT_FILE이 자동으로 설정되었으므로 시간만 지정하면 된다.

## 참고 예시

기존 프롬프트 파일 참고:
- loop-save/flowchart-ui-prompt.txt -- UI 전면 개편 프롬프트, 프론트엔드 전용, 5 Phase
- loop-save/runtime-gap-fix-prompt.txt -- 런타임 갭 수정 프롬프트, 풀스택, 4 Phase
