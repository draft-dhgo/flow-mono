# UI 설계 방향

## 1. 설계 철학

단순한 폼 기반 UI와 LangFlow 같은 풀 노드 에디터 사이의 **"구조화된 시각적 빌더"** 를 지향한다.

```
[단순 폼 UI] ◄──────────── [목표 지점] ──────────────► [LangFlow 노드 에디터]
 - 고정 레이아웃              - 구조가 보이되 복잡하지 않음     - 완전 자유 배치
 - 설정만 가능                - 드래그로 순서 변경              - 노드/엣지 수동 연결
 - 그래프 구조 안 보임         - 리소스 참조가 시각적으로 보임    - 러닝커브 높음
```

### 핵심 원칙
1. **워크플로우 = 세로 레인**: Work들이 위에서 아래로 순차 배치. 순서가 곧 실행 순서
2. **Work = 카드**: 각 Work는 접을 수 있는 카드. 펼치면 Task 목록이 보임
3. **리소스 = 사이드 패널**: Git, MCP Server는 좌측 사이드바에서 관리. Work 카드에 드래그하여 참조
4. **드래그 & 드롭으로 순서 변경**: Work 카드와 Task 항목 모두 드래그로 reorder
5. **인라인 편집**: Task의 query, Report outline 등은 카드 내에서 바로 편집

---

## 2. 화면 구조

```
┌─────────────────────────────────────────────────────────────────┐
│  [Global Nav]  워크플로우 목록 | 템플릿 관리 | 설정              │
├──────────┬──────────────────────────────────┬───────────────────┤
│          │                                  │                   │
│ 리소스    │     워크플로우 캔버스              │   속성 패널       │
│ 패널     │                                  │   (선택된 항목)    │
│          │  ┌─────────────────────────┐     │                   │
│ ▼ Git    │  │ Work 0 [claude-sonnet]  │     │ Work 속성         │
│  repo-A  │  │  ├─ Task 0: "분석..."    │     │  - Model: [▼]    │
│  repo-B  │  │  └─ Task 1: "구현..."    │     │  - MCP: [+추가]  │
│          │  └─────────────────────────┘     │  - Git: repo-A ✓ │
│ ▼ MCP    │           │ (순차)                │       repo-B ✓   │
│  github  │           ▼                      │                   │
│  slack   │  ┌─────────────────────────┐     │                   │
│  jira    │  │ Work 1 [gpt-4]         │     │                   │
│          │  │  └─ Task 0: "리뷰..."    │     │                   │
│ [+추가]  │  └─────────────────────────┘     │                   │
│          │           │                      │                   │
│          │           ▼                      │                   │
│          │  ┌─────────────────────────┐     │                   │
│          │  │ Work 2 [claude-opus]    │     │                   │
│          │  │  └─ Task 0: "문서화..."   │     │                   │
│          │  └─────────────────────────┘     │                   │
│          │                                  │                   │
│          │  [+ Work 추가]                    │                   │
│          │                                  │                   │
├──────────┴──────────────────────────────────┴───────────────────┤
│  [실행 바] ▶ 시작 | ⏸ 일시정지 | ⏹ 취소 | 🔄 Resume             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 주요 인터랙션

### 3.1 워크플로우 빌더 (편집 모드)

| 동작 | 인터랙션 |
|------|---------|
| Work 추가 | 하단 [+ Work 추가] 버튼 → 새 카드 생성 |
| Work 순서 변경 | Work 카드를 드래그하여 위/아래로 이동 |
| Work 삭제 | 카드 우측 상단 삭제 버튼 |
| Task 추가 | Work 카드 내 [+ Task] 버튼 |
| Task 순서 변경 | Task 항목을 드래그하여 위/아래로 이동 |
| Task 편집 | Task 클릭 → 우측 속성 패널에서 query/report 편집 |
| MCP 전역 설정 | 리소스 패널에서 MCP 서버를 워크플로우 헤더 영역에 드롭 |
| MCP Work별 설정 | 리소스 패널에서 MCP 서버를 특정 Work 카드에 드롭 |
| Git 참조 추가 | 리소스 패널에서 Git 리포지토리를 워크플로우 헤더로 드래그 또는 [+ 추가] 버튼 |
| Git 참조 제거 | 워크플로우 헤더 Git 뱃지의 ✕ 클릭 → 확인 팝업 → WorkTree 캐스케이딩 삭제 |
| MCP 전역 제거 | 워크플로우 헤더 MCP 뱃지의 ✕ 클릭 |

### 3.2 실행 모드 (모니터링)

```
Work 카드 상태 표시:
  ┌─────────────────────────────────┐
  │ ● Work 0 [RUNNING]  claude-s.. │  ← 상태 뱃지 + 진행 인디케이터
  │  ├─ ✅ Task 0: "분석..."        │  ← 완료된 Task
  │  └─ ⏳ Task 1: "구현..."        │  ← 현재 실행 중
  │  [Agent 로그 보기]              │  ← 실시간 로그 토글
  └─────────────────────────────────┘
           │ ── checkpoint ──
           ▼
  ┌─────────────────────────────────┐
  │ ○ Work 1 [PENDING]   gpt-4    │  ← 대기 중
  │  └─ ○ Task 0: "리뷰..."        │
  └─────────────────────────────────┘
```

| 동작 | 인터랙션 |
|------|---------|
| 실행 상태 확인 | Work 카드에 상태 뱃지 (PENDING/RUNNING/COMPLETED/FAILED) |
| Agent 로그 | Work 카드 확장 → 실시간 로그 스트림 |
| Checkpoint 표시 | Work 사이에 체크포인트 마커 표시 |
| Resume | FAILED 시 → Resume 버튼 활성화 → Checkpoint 선택 팝업 |

### 3.3 리소스 패널

```
┌──────────────────┐
│ 리소스 관리       │
├──────────────────┤
│ ▼ Git 리포지토리  │
│  ┌──────────┐    │
│  │ 📁 repo-A│◄── │──── 드래그하여 Workflow에 연결
│  └──────────┘    │
│  ┌──────────┐    │
│  │ 📁 repo-B│    │
│  └──────────┘    │
│  [+ Git 추가]    │
│                  │
│ ▼ MCP 서버       │
│  ┌──────────┐    │
│  │ 🔧 github│◄── │──── 드래그하여 전역 또는 Work에 연결
│  └──────────┘    │
│  ┌──────────┐    │
│  │ 🔧 slack │    │     Workflow 헤더 → 전역 MCP
│  └──────────┘    │     Work 카드     → Work별 MCP
│  ┌──────────┐    │
│  │ 🔧 jira  │    │
│  └──────────┘    │
│  [+ MCP 추가]    │
└──────────────────┘
```

**MCP 서버 드롭 대상에 따른 동작**:
- **워크플로우 헤더 영역**에 드롭 → `workflow.mcpServerRefs`에 추가 (모든 Work에 적용)
- **특정 Work 카드**에 드롭 → `work.mcpServerRefs`에 추가 (해당 Work에만 적용)
- Work 카드의 MCP 뱃지에는 "전역" vs "Work별" 구분 표시

### 3.4 워크플로우 헤더 Git/MCP 뱃지

`canModify()` 상태 (CREATED, READY, PAUSED, FAILED)에서 Git/MCP 참조를 자유롭게 변경할 수 있다.

```
┌─────────────────────────────────────────────────┐
│ Workflow: feature-123              [PAUSED]      │
│                                                  │
│ Git: 📁repo-A ✓ ✕  📁repo-B ✓ ✕  [+ 추가]      │
│ MCP: 🔧github ✕  🔧slack ✕        [+ 추가]      │
│                                                  │
│ ※ PAUSED 상태: Git/MCP 변경 가능                  │
└─────────────────────────────────────────────────┘
```

**상태별 동작**
- **CREATED/READY/PAUSED/FAILED**: 뱃지에 제거(✕) 버튼 표시, [+ 추가] 버튼 활성화
- **RUNNING/PREPARING/RESUMING**: 변경 UI 비활성화 (시각적 잠금 표시)

**Git 참조 변경 시 피드백**
- Git 제거 시 확인 팝업: "repo-B를 제거하면 해당 WorkTree가 삭제됩니다. 계속하시겠습니까?"
- Git 추가 시 WorkTree 생성 진행 표시: `📁repo-C ⏳ (WorkTree 생성 중...)`
- 생성 완료: `📁repo-C ✓`
- 생성 실패: `📁repo-C ❌ (재시도)` — 클릭 시 재시도

---

## 4. MCP 설정 UI 상세

### 4.1 MCP 서버 등록 다이얼로그

```
┌─────────────────────────────────────┐
│ MCP 서버 등록                        │
├─────────────────────────────────────┤
│ 이름:      [github-tools         ]  │
│                                     │
│ 전송 방식:  ○ STDIO  ○ SSE  ○ HTTP  │
│                                     │
│ ─── STDIO 설정 ───                   │
│ Command:   [npx                  ]  │
│ Args:      [-y @github/mcp-server]  │
│                                     │
│ ─── 환경 변수 ───                    │
│ GITHUB_TOKEN  [ghp_xxxx...      ] 🔒│
│ [+ 환경 변수 추가]                    │
│                                     │
│         [연결 테스트]  [등록]  [취소]  │
└─────────────────────────────────────┘
```

### 4.2 Work 카드 내 MCP 표시

```
┌───────────────────────────────────────────┐
│ Work 0 [claude-sonnet-4]                  │
│                                           │
│ MCP: 🔧github(전역) 🔧slack(전역) 🔧jira │
│      └─ "jira"는 이 Work에서만 활성        │
│                                           │
│ ├─ Task 0: "이슈 분석하고 코드 수정..."    │
│ └─ Task 1: "PR 생성하고 리뷰 요청..."     │
└───────────────────────────────────────────┘
```

- 전역 MCP는 회색 뱃지, Work별 MCP는 강조 뱃지로 구분
- 뱃지 클릭 → env 오버라이드 팝업 (Work별로 환경 변수 재정의 가능)

---

## 5. 템플릿 관리

### 5.1 템플릿 목록 화면

Global Nav의 "템플릿 관리" 탭에서 접근한다. 모든 WorkflowTemplate을 목록으로 표시한다.

```
┌─────────────────────────────────────────────────────────────────┐
│  [Global Nav]  워크플로우 목록 | ▶ 템플릿 관리 | 설정            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  템플릿 목록                                    [+ 새 템플릿]   │
│                                                                 │
│  ┌────────────────────────────────────────────────────────┐     │
│  │ 📋 코드 리뷰 워크플로우                                │     │
│  │    Work 3개 · Git 2개 · MCP 1개                        │     │
│  │    [워크플로우 생성]  [편집]  [복제]  [삭제]            │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                 │
│  ┌────────────────────────────────────────────────────────┐     │
│  │ 📋 버그 수정 워크플로우                                 │     │
│  │    Work 2개 · Git 1개 · MCP 2개                        │     │
│  │    [워크플로우 생성]  [편집]  [복제]  [삭제]            │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

| 동작 | 인터랙션 |
|------|---------|
| 새 템플릿 생성 | [+ 새 템플릿] → 빈 템플릿 빌더 화면 진입 |
| 워크플로우 생성 | [워크플로우 생성] → issueKey, branchStrategy 입력 다이얼로그 → 깊은 복사로 Workflow 생성 |
| 편집 | [편집] → 템플릿 빌더 화면 진입 (워크플로우 빌더와 동일 UI) |
| 복제 | [복제] → 동일 구조의 새 Template 생성 |
| 삭제 | [삭제] → 확인 팝업. 기존 Workflow에 영향 없음 안내 |

### 5.2 템플릿 빌더

워크플로우 빌더(섹션 3.1)와 동일한 캔버스 UI를 공유한다. 차이점:

| 항목 | 워크플로우 빌더 | 템플릿 빌더 |
|------|----------------|------------|
| 실행 바 | ▶ 시작 / ⏸ 일시정지 등 | 없음 (실행 불가) |
| issueKey/branchStrategy | 편집 가능 | 없음 (Workflow 생성 시 입력) |
| 상태 표시 | 실행 상태 뱃지 | 없음 |
| 저장 | 자동/수동 저장 | [템플릿 저장] 버튼 |

### 5.3 Workflow에서 템플릿 추출

실행 완료(COMPLETED) 또는 취소(CANCELLED) 된 Workflow에서 역으로 Template을 생성할 수 있다.

```
┌─────────────────────────────────────────────────────────┐
│ Workflow: feature-123               [COMPLETED]         │
│                                                         │
│ [···] 메뉴 → [템플릿으로 저장]                            │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────┐
│ 템플릿으로 저장                      │
├─────────────────────────────────────┤
│ 템플릿 이름: [feature-123 기반     ] │
│ 설명:       [                      ] │
│                                     │
│ 추출 내용 미리보기:                  │
│  ✓ Work 구조 (3개 Work, 5개 Task)   │
│  ✓ Git 참조 (2개 GitRef)            │
│  ✓ MCP 서버 참조 (전역 1 + Work별 2) │
│  ✓ Agent 모델 설정                   │
│                                     │
│              [저장]  [취소]          │
└─────────────────────────────────────┘
```

- Workflow의 Work → WorkDefinition, Task → TaskDefinition으로 변환
- issueKey, branchStrategy 등 인스턴스 고유 값은 제외
- 생성된 Template은 원본 Workflow와 완전히 독립

---

## 6. LangFlow 대비 차별점

| 항목 | LangFlow | 본 시스템 UI |
|------|---------|------------|
| **레이아웃** | 자유 배치 (2D 캔버스) | 세로 레인 (순차 흐름이 명확) |
| **연결** | 노드 간 수동 엣지 연결 | 순서 = 실행 순서 (자동 연결) |
| **리소스** | 노드의 설정값으로 입력 | 별도 패널에서 관리 + 드래그 참조 |
| **실행 모니터링** | 별도 화면 | 같은 캔버스에서 실시간 상태 표시 |
| **러닝커브** | 노드 개념 이해 필요 | 리스트/카드 기반으로 직관적 |
| **유연성** | 임의 DAG 지원 | 순차 실행에 최적화 (Work/Task 계층) |

---

## 7. 기술 스택 (권장)

| 계층 | 기술 | 이유 |
|------|------|------|
| 프레임워크 | React + TypeScript | 생태계, 컴포넌트 재사용 |
| 상태 관리 | Zustand 또는 Jotai | 경량, 워크플로우 상태에 적합 |
| 드래그 & 드롭 | dnd-kit | 접근성 지원, 세로 리스트 최적화 |
| 스타일 | Tailwind CSS + shadcn/ui | 빠른 프로토타이핑, 일관된 디자인 |
| 실시간 통신 | WebSocket (STOMP) 또는 SSE | 실행 상태 실시간 동기화 |

---

## 관련 문서
- [01-서비스-개요.md](backend/01-서비스-개요.md) — 시스템 전체 개요
- [03-유스케이스.md](backend/03-유스케이스.md) — UI가 호출하는 유스케이스
- [04-이벤트-흐름.md](backend/04-이벤트-흐름.md) — 실시간 모니터링에 사용되는 이벤트
